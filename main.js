(()=>{var e,t,n={137:(e,t,n)=>{"use strict";var r=String.prototype.replace,i=/%20/g,s=n(733),o={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=s.assign({default:o.RFC3986,formatters:{RFC1738:function(e){return r.call(e,i,"+")},RFC3986:function(e){return String(e)}}},o)},998:(e,t,n)=>{"use strict";var r=n(733),i=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},u=function(e,t){if(s(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},l=function(e,t,n,r){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(s),u=a?s.slice(0,a.index):s,l=[];if(u){if(!n.plainObjects&&i.call(Object.prototype,u)&&!n.allowPrototypes)return;l.push(u)}for(var h=0;n.depth>0&&null!==(a=o.exec(s))&&h<n.depth;){if(h+=1,!n.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+s.slice(a.index)+"]"),function(e,t,n,r){for(var i=r?t:c(t,n),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&n.parseArrays)o=[].concat(i);else{o=n.plainObjects?Object.create(null):{};var u="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(u,10);n.parseArrays||""!==u?!isNaN(l)&&a!==u&&String(l)===u&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(o=[])[l]=i:o[u]=i:o={0:i}}i=o}return i}(l,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var h="string"==typeof e?function(e,t){var n,l={},h=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,p=h.split(t.delimiter,d),g=-1,f=t.charset;if(t.charsetSentinel)for(n=0;n<p.length;++n)0===p[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[n]?f="utf-8":"utf8=%26%2310003%3B"===p[n]&&(f="iso-8859-1"),g=n,n=p.length);for(n=0;n<p.length;++n)if(n!==g){var _,y,m=p[n],b=m.indexOf("]="),v=-1===b?m.indexOf("="):b+1;-1===v?(_=t.decoder(m,o.decoder,f,"key"),y=t.strictNullHandling?null:""):(_=t.decoder(m.slice(0,v),o.decoder,f,"key"),y=u(c(m.slice(v+1),t),(function(e){return t.decoder(e,o.decoder,f,"value")}))),y&&t.interpretNumericEntities&&"iso-8859-1"===f&&(y=a(y)),m.indexOf("[]=")>-1&&(y=s(y)?[y]:y),i.call(l,_)?l[_]=r.combine(l[_],y):l[_]=y}return l}(e,n):e,d=n.plainObjects?Object.create(null):{},p=Object.keys(h),g=0;g<p.length;++g){var f=p[g],_=l(f,h[f],n,"string"==typeof e);d=r.merge(d,_,n)}return r.compact(d)}},149:(e,t,n)=>{"use strict";var r=n(733),i=n(137),s=Object.prototype.hasOwnProperty,o={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,a(t)?t:[t])},l=Date.prototype.toISOString,h=i.default,d={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:h,formatter:i.formatters[h],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(t,n,i,s,o,c,l,h,p,g,f,_,y){var m,b=t;if("function"==typeof l?b=l(n,b):b instanceof Date?b=g(b):"comma"===i&&a(b)&&(b=b.join(",")),null===b){if(s)return c&&!_?c(n,d.encoder,y,"key"):n;b=""}if("string"==typeof(m=b)||"number"==typeof m||"boolean"==typeof m||"symbol"==typeof m||"bigint"==typeof m||r.isBuffer(b))return c?[f(_?n:c(n,d.encoder,y,"key"))+"="+f(c(b,d.encoder,y,"value"))]:[f(n)+"="+f(String(b))];var v,w=[];if(void 0===b)return w;if(a(l))v=l;else{var C=Object.keys(b);v=h?C.sort(h):C}for(var k=0;k<v.length;++k){var I=v[k];o&&null===b[I]||(a(b)?u(w,e(b[I],"function"==typeof i?i(n,I):n,i,s,o,c,l,h,p,g,f,_,y)):u(w,e(b[I],n+(p?"."+I:"["+I+"]"),i,s,o,c,l,h,p,g,f,_,y)))}return w};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return d;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||d.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=i.default;if(void 0!==e.format){if(!s.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=i.formatters[n],o=d.filter;return("function"==typeof e.filter||a(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:d.addQueryPrefix,allowDots:void 0===e.allowDots?d.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:d.charsetSentinel,delimiter:void 0===e.delimiter?d.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:d.encode,encoder:"function"==typeof e.encoder?e.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:d.encodeValuesOnly,filter:o,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:d.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:d.strictNullHandling}}(t);"function"==typeof c.filter?r=(0,c.filter)("",r):a(c.filter)&&(n=c.filter);var l,h=[];if("object"!=typeof r||null===r)return"";l=t&&t.arrayFormat in o?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var g=o[l];n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var f=0;f<n.length;++f){var _=n[f];c.skipNulls&&null===r[_]||u(h,p(r[_],_,g,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var y=h.join(c.delimiter),m=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),y.length>0?m+y:""}},733:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n=Array.isArray,r=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),i=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:i,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],o=s.obj[s.prop],a=Object.keys(o),c=0;c<a.length;++c){var u=a[c],l=o[u];"object"==typeof l&&null!==l&&-1===r.indexOf(l)&&(t.push({obj:o,prop:u}),r.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(n(r)){for(var i=[],s=0;s<r.length;++s)void 0!==r[s]&&i.push(r[s]);t.obj[t.prop]=i}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n){if(0===e.length)return e;var i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var s="",o=0;o<i.length;++o){var a=i.charCodeAt(o);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?s+=i.charAt(o):a<128?s+=r[a]:a<2048?s+=r[192|a>>6]+r[128|63&a]:a<55296||a>=57344?s+=r[224|a>>12]+r[128|a>>6&63]+r[128|63&a]:(o+=1,a=65536+((1023&a)<<10|1023&i.charCodeAt(o)),s+=r[240|a>>18]+r[128|a>>12&63]+r[128|a>>6&63]+r[128|63&a])}return s},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(r,s,o){if(!s)return r;if("object"!=typeof s){if(n(r))r.push(s);else{if(!r||"object"!=typeof r)return[r,s];(o&&(o.plainObjects||o.allowPrototypes)||!t.call(Object.prototype,s))&&(r[s]=!0)}return r}if(!r||"object"!=typeof r)return[r].concat(s);var a=r;return n(r)&&!n(s)&&(a=i(r,o)),n(r)&&n(s)?(s.forEach((function(n,i){if(t.call(r,i)){var s=r[i];s&&"object"==typeof s&&n&&"object"==typeof n?r[i]=e(s,n,o):r.push(n)}else r[i]=n})),r):Object.keys(s).reduce((function(n,r){var i=s[r];return t.call(n,r)?n[r]=e(n[r],i,o):n[r]=i,n}),a)}}},643:e=>{e.exports=!1},104:(e,t,n)=>{var r,i,s;!function(o){if("object"==typeof e.exports){var a=o(n(636),t);void 0!==a&&(e.exports=a)}else i=[n,t],void 0===(s="function"==typeof(r=o)?r.apply(t,i):r)||(e.exports=s)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Timeout=t.repeatedStart=t.delayError=t.callbackError=void 0,t.callbackError="Expeting to get a cb function as the first argument",t.delayError="Delay argument should be a number >= 0",t.repeatedStart="Timeout was already started";var n=function(){function e(e,n){this._pending=!1,this._canceled=!1,this._paused=!1;var r="number"==typeof e?e:n;if("number"!=typeof r||r<0)throw new Error(t.delayError);this._delay=r,this._timeLeft=r,"number"!=typeof e&&this.start(e)}return Object.defineProperty(e.prototype,"isPending",{get:function(){return this._pending},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return null!=this._startTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._canceled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFinished",{get:function(){return!this.isPending&&!this._canceled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFinishedPreemptively",{get:function(){return this.isFinished&&this._timeLeft>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeLeft",{get:function(){return!this._pending||this._paused?this._timeLeft:this._delay-((new Date).getTime()-this._startTime)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timePassed",{get:function(){return this._delay-this.timeLeft},enumerable:!1,configurable:!0}),e.prototype._run=function(){var e=this;this._startTime=(new Date).getTime(),this._pending=!0,this._canceled=!1,this._paused=!1,this._to=setTimeout((function(){e._to=null,e._pending=!1,e._timeLeft=0,e._cb()}),this._timeLeft)},e.prototype._halt=function(){this._to&&(clearTimeout(this._to),this._to=null),this._timeLeft=this.timeLeft},e.prototype.start=function(e){var n=this;if(null!=e){if("function"!=typeof e)throw new Error(t.callbackError);return!this._pending&&(this._cb=e,this._run(),!0)}return new Promise((function(e,r){if(n._pending)return r(t.repeatedStart);n._cb=e,n._run()}))},e.prototype.cancel=function(){return!!this._pending&&(this._halt(),this._pending=!1,this._canceled=!0,!0)},e.prototype.execute=function(){return!!this._pending&&(this._halt(),this._pending=!1,this._cb(),!0)},e.prototype.pause=function(){return!(!this._pending||this._paused||(this._halt(),this._paused=!0,0))},e.prototype.resume=function(){return!(!this._pending||!this._paused||(this._run(),0))},Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(e){e?this.pause():this.resume()},enumerable:!1,configurable:!0}),e.prototype.reset=function(e){if(null==e&&(e=this._delay),"number"!=typeof e||e<0)throw new Error(t.delayError);if(this.isStarted){if(!this.isPending)return!1;this._halt(),this._delay=e,this._timeLeft=e,this._run()}else this._delay=e,this._timeLeft=e;return!0},Object.defineProperty(e.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),e}();t.Timeout=n,t.default=n}))},636:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=636,e.exports=t},300:(e,t)=>{"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}};return n[e](s,s.exports,i),s.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var s=Object.create(null);i.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>n[e]));return o.default=()=>n,i.d(s,o),s},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}function r(e){return void 0===e&&(e=!0),function(t,n){Object.defineProperty(t,n,{get:function(){},set:function(t){Object.defineProperty(this,n,{value:t,writable:!0,enumerable:e})},enumerable:e})}}function s(e,t,n){return r=>{const i=n?function(){return`[${t}#${this[n]} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`}:function(){return`[${t} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}Object.create,Object.create;var o=i(300),a=o.default||o;const c=o.Headers;o.Request,o.Response;var u=i(149);i(998),i(137);class l extends Error{constructor(e,t){var n;super(e,t),Object.setPrototypeOf(this,new.target.prototype),null===(n=Error.captureStackTrace)||void 0===n||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}class h extends l{constructor(e,t,n,r,i,s){super(`Encountered HTTP status code ${e}: ${t}\n\nURL: ${n}\nMethod: ${r}\nBody:\n${!s&&i.length>150?`${i.slice(0,147)}...`:i}`),this._statusCode=e,this._url=n,this._method=r,this._body=i}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function d(e,t,n,r,i={}){const s=await async function(e,t,n,r,i={}){var s,o;const l=null!==(s=e.type)&&void 0!==s?s:"helix",h=function(e,t){switch(t){case"helix":return`https://api.twitch.tv/helix/${e.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${e.replace(/^\//,"")}`;default:return e}}(e.url,l),d=u(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),p=new c({Accept:"application/json"});let g;e.jsonBody&&(g=JSON.stringify(e.jsonBody),p.append("Content-Type","application/json")),t&&"auth"!==l&&p.append("Client-ID",t),n&&p.append("Authorization",`${"helix"===l?null!=r?r:"Bearer":"OAuth"} ${n}`);const f={...i,method:null!==(o=e.method)&&void 0!==o?o:"GET",headers:p,body:g};return await function(e,t){return/^\/\//.test(e)&&(e="https:"+e),a.call(this,e,t)}(`${h}${d}`,f)}(e,t,n,r,i);return await async function(e,t){var n;if(!e.ok){const r="application/json"===e.headers.get("Content-Type"),i=r?JSON.stringify(await e.json(),null,2):await e.text(),s=u(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),o=`${t.url}${s}`;throw new h(e.status,e.statusText,o,null!==(n=t.method)&&void 0!==n?n:"GET",i,r)}}(s,e),await async function(e){if(204===e.status)return;const t=await e.text();return t?JSON.parse(t):void 0}(s)}class p extends l{constructor(e){super("Invalid token supplied",e)}}function g(e){return null==e}function f(e,t){return g(e)?void 0:t(e)}const _=Symbol("twurpleRawData");class y{constructor(e){this[_]=e}}let m=class extends y{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[_].client_id}get userId(){var e;return null!==(e=this[_].user_id)&&void 0!==e?e:null}get userName(){var e;return null!==(e=this[_].login)&&void 0!==e?e:null}get scopes(){return this[_].scopes}get expiryDate(){return t=e=>new Date(this._obtainmentDate.getTime()+1e3*e),g(e=this[_].expires_in)?null:t(e);var e,t}};async function b(e,t){try{const n=await d({type:"auth",url:"validate"},t,e);return new m(n)}catch(e){if(e instanceof h&&401===e.statusCode)throw new p({cause:e});throw e}}async function v(e,t,n){let r=null;try{const n=await e.getAccessToken(t);if(n)return{accessToken:n,tokenInfo:await b(n.accessToken)}}catch(e){e instanceof p?r=e:null==n||n.error(`Retrieving an access token failed: ${e.message}`)}if(null==n||n.warn("No valid token available; trying to refresh"),e.refresh)try{const t=await e.refresh();if(t)return{accessToken:t,tokenInfo:await b(t.accessToken)}}catch(e){e instanceof p?r=e:null==n||n.error(`Refreshing the access token failed: ${e.message}`)}throw null!=r?r:new Error("Could not retrieve a valid token")}m=n([s("auth","TokenInfo","clientId")],m);const w=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);let C=class{constructor(e,t,n,r="user"){this._clientId=e||"",this.tokenType=r,this._accessToken="string"==typeof t?{accessToken:t,refreshToken:null,scope:null!=n?n:[],expiresIn:null,obtainmentTimestamp:Date.now()}:t,this._scopes=n}async getAccessToken(e){return this._scopes=await async function(e,t,n,r){if(null==r?void 0:r.length){const i=null!=n?n:(await b(t,e)).scopes;return function(e,t){if(void 0!==t){const n=new Set(e.flatMap((e=>{var t;return[e,...null!==(t=w.get(e))&&void 0!==t?t:[]]})));if(t.some((e=>!n.has(e))))throw new Error(`This token does not have the requested scopes (${t.join(", ")}) and can not be upgraded.\nIf you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:\n\n\thttps://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}(i,r),i}return n}(this._clientId,this._accessToken.accessToken,this._scopes,e),this._accessToken}get clientId(){return this._clientId}get currentScopes(){var e;return null!==(e=this._scopes)&&void 0!==e?e:[]}};n([r(!1)],C.prototype,"_clientId",void 0),n([r(!1)],C.prototype,"_accessToken",void 0),C=n([s("auth","StaticAuthProvider","clientId")],C);class k extends l{}function I(e){return"string"==typeof e?e:"number"==typeof e?e.toString(10):e.id}function O(e){return t=this,n=void 0,i=function(){return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))},new((r=Promise)||(r=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}c((i=i.apply(t,n||[])).next())}));var t,n,r,i}class L{constructor(e,t,n,r=!1){this.owner=e,this.event=t,this.listener=n,this._internal=r}unbind(){this.owner.removeListener(this)}}class x{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,t){return this._addListener(!1,e,t)}addListener(e,t){return this._addListener(!1,e,t)}removeListener(e,t){this._removeListener(!1,e,t)}registerEvent(){const e=t=>this.addListener(e,t);return e}emit(e,...t){if(this._eventListeners.has(e))for(const n of this._eventListeners.get(e))n(...t);if(this._internalEventListeners.has(e))for(const n of this._internalEventListeners.get(e))n(...t)}registerInternalEvent(){const e=t=>this.addInternalListener(e,t);return e}addInternalListener(e,t){return this._addListener(!0,e,t)}removeInternalListener(e,t){this._removeListener(!0,e,t)}_addListener(e,t,n){const r=e?this._eventListeners:this._internalEventListeners;return r.has(t)?r.get(t).push(n):r.set(t,[n]),new L(this,t,n,e)}_removeListener(e,t,n){const r=e?this._eventListeners:this._internalEventListeners;if(t)if("object"==typeof t){const e=t;this._removeListener(e._internal,e.event,e.listener)}else{const e=t;if(r.has(e))if(n){const t=r.get(e);let i=0;for(;-1!==(i=t.indexOf(n));)t.splice(i,1)}else r.delete(e)}else r.clear()}}class E extends x{constructor(e,t,n={}){var r;super(),this._type=e,this._target=t,this._config=n,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=null!==(r=n.retryLimit)&&void 0!==r?r:1/0,this._logger=n.logger}get isConnected(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.isConnected)&&void 0!==t&&t}get isConnecting(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.isConnecting)&&void 0!==t?t:this._connecting}get hasSocket(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.hasSocket)&&void 0!==t&&t}sendLine(e){var t;null===(t=this._currentConnection)||void 0===t||t.sendLine(e)}async connect(){await this._connect(!0)}async disconnect(){var e;if(null===(e=this._logger)||void 0===e||e.trace(`PersistentConnection disconnect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const e=this._currentConnection;this._currentConnection=void 0,await e.disconnect()}}assumeExternalDisconnect(){var e,t;null===(e=this._logger)||void 0===e||e.trace("PersistentConnection assumeExternalDisconnect"),null===(t=this._currentConnection)||void 0===t||t.assumeExternalDisconnect()}async reconnect(){await this._reconnect(!0)}async _connect(e=!1){var t,n,r,i;if(null===(t=this._logger)||void 0===t||t.trace(`PersistentConnection connect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._currentConnection||this._connecting)throw new Error("Connection already present");this._connectionRetryCount=0,this._connecting=!0;const s=e?this._initialRetryLimit:this._retryLimit;for(this._retryTimerGenerator=E._getReconnectWaitTime();this._connectionRetryCount<=s;){const t=this._currentConnection=new this._type(this._target,this._config);t.onReceive((e=>this.emit(this.onReceive,e))),t.onConnect((()=>this.emit(this.onConnect))),t.onDisconnect(((e,n)=>{this.emit(this.onDisconnect,e,n),e?(this.emit(this.onEnd,!0),t.disconnect(),this._currentConnection===t&&(this._currentConnection=void 0)):this._connecting||this._reconnect()}));try{return await t.connect(),void(this._connecting=!1)}catch(t){if(!this._connecting)return;if(null===(n=this._logger)||void 0===n||n.debug(`Connection error caught: ${t.message}`),this._connectionRetryCount>=s)break;this._connectionRetryCount++;const o=this._retryTimerGenerator.next().value;if(0!==o&&(null===(r=this._logger)||void 0===r||r.info(`Retrying in ${o} seconds`)),await O(1e3*o),null===(i=this._logger)||void 0===i||i.info(e?"Retrying connection":"Trying to reconnect"),!this._connecting)return}}const o=new Error(`Connection failed after trying ${s} times`);if(this.emit(this.onEnd,!1,o),e)throw o}async _reconnect(e=!1){this.disconnect().catch((e=>{var t;return null===(t=this._logger)||void 0===t?void 0:t.error(`Error while disconnecting for the reconnect: ${e.message}`)})),await this._connect(e)}static*_getReconnectWaitTime(){let e=0,t=1;for(;e<120;)yield e,[e,t]=[t,e+t];for(;;)yield 120}}var P=null;"undefined"!=typeof WebSocket?P=WebSocket:"undefined"!=typeof MozWebSocket?P=MozWebSocket:"undefined"!=typeof global?P=global.WebSocket||global.MozWebSocket:"undefined"!=typeof window?P=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(P=self.WebSocket||self.MozWebSocket);class R extends x{constructor({lineBased:e,logger:t,additionalOptions:n}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=null!=e&&e,this._logger=t,this._additionalOptions=n}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r\n`))}assumeExternalDisconnect(){var e;null===(e=this._logger)||void 0===e||e.trace("AbstrctConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.emit(this.onDisconnect,!1)}receiveRaw(e){var t,n;if(!this._lineBased)return void this.emit(this.onReceive,e);const r=e.split("\r\n");if(this._currentLine+=null!==(t=r.shift())&&void 0!==t?t:"",r.length){this.emit(this.onReceive,this._currentLine),this._currentLine=null!==(n=r.pop())&&void 0!==n?n:"";for(const e of r)this.emit(this.onReceive,e)}}}class S extends R{constructor(e,t){if(super(t),this._socket=null,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else{if(!e.url)throw new Error("WebSocketConnection requires either hostName & port or url to be set");this._url=e.url}}get hasSocket(){return!!this._socket}sendRaw(e){var t;null===(t=this._socket)||void 0===t||t.send(e)}async connect(){var e;null===(e=this._logger)||void 0===e||e.trace("WebSocketConnection connect"),await new Promise(((e,t)=>{var n;this._connecting=!0,this._socket=new P(this._url,null===(n=this._additionalOptions)||void 0===n?void 0:n.wsOptions),this._socket.onopen=()=>{var t;null===(t=this._logger)||void 0===t||t.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this.emit(this.onConnect),e()},this._socket.onmessage=({data:e})=>{this.receiveRaw(e.toString())},this._socket.onerror=e=>{var t;null===(t=this._logger)||void 0===t||t.trace(`WebSocketConnection onError message:${e.message}`)},this._socket.onclose=e=>{var n;const r=this._connected;if(null===(n=this._logger)||void 0===n||n.trace(`WebSocketConnection onClose wasConnected:${r.toString()} wasClean:${e.wasClean.toString()}`),this._connected=!1,this._connecting=!1,e.wasClean)this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const n=new Error(`[${e.code}] ${e.reason}`);this.emit(this.onDisconnect,!1,n),this.emit(this.onEnd,!1,n),r||t(n)}this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}))}async disconnect(){var e;null===(e=this._logger)||void 0===e||e.trace("WebSocketConnection disconnect"),await new Promise((e=>{if(this._socket){const t=this.onDisconnect((()=>{t.unbind(),e()}));this._socket.close()}else e()}))}}var T,j,N=i(643),D=i.t(N,2);function A(e){if("number"==typeof e){if(Object.prototype.hasOwnProperty.call(j,e))return e;var t=Object.keys(j).map((function(e){return parseInt(e,10)})).filter((function(t){return!isNaN(t)&&t<e}));return t.length?Math.max.apply(Math,t):j.WARNING}var n=e.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(j,n))throw new Error("Unknown log level string: "+e);return j[n]}!function(e){e[e.CRITICAL=0]="CRITICAL",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e[e.TRACE=7]="TRACE"}(j||(j={}));var B,M,$=D?console.log.bind(console):console.debug.bind(console),U=((T={})[j.CRITICAL]=console.error.bind(console),T[j.ERROR]=console.error.bind(console),T[j.WARNING]=console.warn.bind(console),T[j.INFO]=console.info.bind(console),T[j.DEBUG]=$.bind(console),T[j.TRACE]=console.trace.bind(console),T),G="undefined"==typeof process?[]:null!==(M=null===(B=process.env.LOGGING)||void 0===B?void 0:B.split(";").map((function(e){var t=e.split("=",2),n=t[0],r=t[1];return r?["default"===n?void 0:n.split(":"),A(r)]:null})).filter((function(e){return!!e})).sort((function(e,t){var n,r,i=e[0],s=t[0];return(null!==(n=null==s?void 0:s.length)&&void 0!==n?n:0)-(null!==(r=null==i?void 0:i.length)&&void 0!==r?r:0)})))&&void 0!==M?M:[],W=G.findIndex((function(e){return!e[0]})),F=void 0;function H(e,t){return t.length<=e.length&&t.every((function(t,n){return t===e[n]}))}function Q(e){for(var t=e.split(":"),n=0,r=G;n<r.length;n++){var i=r[n],s=i[0],o=i[1];if(H(t,s))return o}return F}-1!==W&&(F=G[W][1],G.splice(W));var z,q,J,V=function(){function e(e){var t,n,r=e.name,i=e.minLevel,s=e.emoji,o=void 0!==s&&s,a=e.colors,c=e.timestamps,u=void 0===c?D:c;this._name=r,this._minLevel=null!==(n=null!==(t=f(i,(function(e){return A(e)})))&&void 0!==t?t:Q(r))&&void 0!==n?n:j.WARNING,this._emoji=o,this._colors=a,this._timestamps=u}return e.prototype.crit=function(e){this.log(j.CRITICAL,e)},e.prototype.error=function(e){this.log(j.ERROR,e)},e.prototype.warn=function(e){this.log(j.WARNING,e)},e.prototype.info=function(e){this.log(j.INFO,e)},e.prototype.debug=function(e){this.log(j.DEBUG,e)},e.prototype.trace=function(e){this.log(j.TRACE,e)},e}(),Y=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.log=function(e,t){if(!(e>this._minLevel)){var n=U[e],r="["+this._name+"] "+t;this._timestamps&&(r="["+(new Date).toISOString()+"] "+t),n(r)}},n}(V),K=function(){function e(e){var t,n=e.name,r=e.minLevel,i=e.custom;this._minLevel=null!==(t=f(r,(function(e){return A(e)})))&&void 0!==t?t:Q(n),this._override="function"==typeof i?{log:i}:i}return e.prototype.log=function(e,t){this._shouldLog(e)&&this._override.log(e,t)},e.prototype.crit=function(e){this._override.crit?this._shouldLog(j.CRITICAL)&&this._override.crit(e):this.log(j.CRITICAL,e)},e.prototype.error=function(e){this._override.error?this._shouldLog(j.ERROR)&&this._override.error(e):this.log(j.ERROR,e)},e.prototype.warn=function(e){this._override.warn?this._shouldLog(j.WARNING)&&this._override.warn(e):this.log(j.WARNING,e)},e.prototype.info=function(e){this._override.info?this._shouldLog(j.INFO)&&this._override.info(e):this.log(j.INFO,e)},e.prototype.debug=function(e){this._override.debug?this._shouldLog(j.DEBUG)&&this._override.debug(e):this.log(j.DEBUG,e)},e.prototype.trace=function(e){this._override.trace?this._shouldLog(j.TRACE)&&this._override.trace(e):this.log(j.TRACE,e)},e.prototype._shouldLog=function(e){return void 0===this._minLevel||this._minLevel>=e},e}(),X=((z={})[j.CRITICAL]="ðŸ›‘",z[j.ERROR]="âŒ",z[j.WARNING]="âš ï¸ ",z[j.INFO]="â„¹ï¸ ",z[j.DEBUG]="ðŸž",z[j.TRACE]="ðŸ¾",z),Z={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},ee={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function te(e,t,n){return function(r){return"["+e+"m"+(n?n(r):r)+"["+t+"m"}}function ne(e){return te(Z[e],39)}function re(e,t){return te(ee[e],49,t)}var ie,se=((q={})[j.CRITICAL]=ne("red"),q[j.ERROR]=ne("redBright"),q[j.WARNING]=ne("yellow"),q[j.INFO]=ne("blue"),q[j.DEBUG]=ne("magenta"),q[j.TRACE]=te(0,0),q),oe=((J={})[j.CRITICAL]=re("bgRed",ne("white")),J[j.ERROR]=re("bgRedBright",ne("white")),J[j.WARNING]=re("bgYellow",ne("black")),J[j.INFO]=re("bgBlue",ne("white")),J[j.DEBUG]=re("bgMagenta",ne("black")),J[j.TRACE]=te(7,27),J),ae=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.log=function(e,t){var n,r,i;if(!(e>this._minLevel)){var s=U[e],o="";this._timestamps&&(o+="["+(new Date).toISOString()+"] "),this._emoji&&(o+=X[e]+" "),s(o+=null===(i=null!==(n=this._colors)&&void 0!==n?n:null===(r=process.stdout)||void 0===r?void 0:r.isTTY)||void 0===i||i?oe[e](this._name)+" "+oe[e](j[e])+" "+se[e](t):"["+this._name+":"+j[e].toLowerCase()+"] "+t)}},n}(V);class ce extends l{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}let ue=ie=class extends x{constructor(e){super(),this._topics=new Map,this._pingOnActivity=240,this._pingOnInactivity=60,this._pingTimeout=10,this._onPong=this.registerInternalEvent(),this._onResponse=this.registerInternalEvent(),this.onMessage=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPong=this.registerEvent(),this._logger=function(e){return e.custom?new K(e):D?new ae(e):new Y(e)}({name:"twurple:pubsub",emoji:!0,...null==e?void 0:e.logger}),this._connection=new E(S,{hostName:"pubsub-edge.twitch.tv",port:443,secure:!0},{logger:this._logger,additionalOptions:{wsOptions:null==e?void 0:e.wsOptions}}),this._connection.onConnect((async()=>{this._logger.info("Connection established"),this._pingCheck(),this._startActivityPingCheckTimer(),this._startInactivityPingCheckTimer(),await this._resendListens(),this._topics.size&&(this._logger.info("Listened to previously registered topics"),this._logger.debug(`Previously registered topics: ${Array.from(this._topics.keys()).join(", ")}`)),this.emit(this.onConnect)})),this._connection.onReceive((e=>{this._receiveMessage(e.trim()),this._startInactivityPingCheckTimer()})),this._connection.onDisconnect(((e,t)=>{clearInterval(this._activityPingCheckTimer),clearInterval(this._inactivityPingCheckTimer),clearTimeout(this._pingTimeoutTimer),this.removeInternalListener(),e?this._logger.info("Disconnected"):t?this._logger.error(`Disconnected unexpectedly: ${t.message}`):this._logger.error("Disconnected unexpectedly"),this.emit(this.onDisconnect,e,t)}))}async listen(e,t,n){"string"==typeof e&&(e=[e]);const r=ie._wrapResolvable(t,n);for(const t of e)this._topics.set(t,r);this.isConnected&&await this._sendListen(e,await this._resolveToken(r))}async unlisten(e){"string"==typeof e&&(e=[e]);for(const t of e)this._topics.delete(t);this.isConnected&&await this._sendUnlisten(e)}async connect(){this._connection.isConnected||this._connection.isConnecting||(this._logger.info("Connecting..."),await this._connection.connect())}async disconnect(){this._logger.info("Disconnecting..."),await this._connection.disconnect()}async reconnect(){await this.disconnect(),await this.connect()}get isConnecting(){return this._connection.isConnecting}get isConnected(){return this._connection.isConnected}get hasAnyTopics(){return this._topics.size>0}async _sendListen(e,t){await this._sendNonced(function(e,t){return{type:"LISTEN",data:{topics:e,auth_token:t}}}(e,t))}async _sendUnlisten(e){await this._sendNonced({type:"UNLISTEN",data:{topics:e}})}static _wrapResolvable(e,t){switch(typeof e){case"object":return"type"in e?e:{type:"provider",provider:e,scopes:t?[t]:[]};case"string":return{type:"static",token:e};case"function":return{type:"function",function:e};default:throw new ce("Passed unknown type to wrapResolvable: "+typeof e)}}async _resolveToken(e){switch(e.type){case"provider":{const{provider:t,scopes:n}=e,{accessToken:r}=await v(t,n,this._logger);return r.accessToken}case"function":return await e.function();case"static":return e.token;default:throw new ce(`Passed unknown type to resolveToken: ${e.type}`)}}async _resendListens(){const e=new Map;for(const[t,n]of this._topics)e.has(n)?e.get(n).push(t):e.set(n,[t]);const t=new Map;for(const[n,r]of e){const e=await this._resolveToken(n);t.has(e)?t.get(e).push(...r):t.set(e,r)}return await Promise.all(Array.from(t.entries()).map((async([e,t])=>await this._sendListen(t,e))))}async _sendNonced(e){await new Promise(((t,n)=>{const r=Math.random().toString(16).slice(2),i=this._onResponse(((s,o)=>{s===r&&(o?n(new Error(`Error sending nonced ${e.type} packet: ${o}`)):t(),i.unbind())}));e.nonce=r,this._sendPacket(e)}))}_receiveMessage(e){this._logger.debug(`Received message: ${e}`);const t=JSON.parse(e);switch(t.type){case"PONG":this.emit(this._onPong);break;case"RECONNECT":this.reconnect();break;case"RESPONSE":this.emit(this._onResponse,t.nonce,t.error);break;case"MESSAGE":this.emit(this.onMessage,t.data.topic,JSON.parse(t.data.message));break;default:this._logger.warn(`PubSub connection received unexpected message type: ${t.type}`)}}_sendPacket(e){const t=JSON.stringify(e);this._logger.debug(`Sending message: ${t}`),this._connection.sendLine(t)}_pingCheck(){const e=Date.now();this._onPong((()=>{const t=Date.now()-e;this.emit(this.onPong,t,e),this._logger.info(`Current latency: ${t}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeInternalListener(this._onPong)})),this._pingTimeoutTimer=setTimeout((async()=>{this._logger.error("Ping timeout"),this.removeInternalListener(this._onPong),this._connection.assumeExternalDisconnect()}),1e3*this._pingTimeout),this._sendPacket({type:"PING"})}_startActivityPingCheckTimer(){clearInterval(this._activityPingCheckTimer),this._connection.isConnected?this._activityPingCheckTimer=setInterval((()=>{this._startInactivityPingCheckTimer(),this._pingCheck()}),1e3*this._pingOnActivity):this._activityPingCheckTimer=void 0}_startInactivityPingCheckTimer(){clearInterval(this._inactivityPingCheckTimer),this._connection.isConnected?this._inactivityPingCheckTimer=setInterval((()=>{this._startActivityPingCheckTimer(),this._pingCheck()}),1e3*this._pingOnInactivity):this._inactivityPingCheckTimer=void 0}};n([r(!1)],ue.prototype,"_logger",void 0),n([r(!1)],ue.prototype,"_topics",void 0),ue=ie=n([s("pubsub","BasicPubSubClient")],ue);let le=class extends y{constructor(e,t){super(e),this._channelId=t}get channelId(){return this._channelId}get messageId(){return this[_].data.message.id}get messageContent(){return this[_].data.message.content.text}get foundMessageFragments(){return this[_].data.message.content.fragments}get senderId(){return this[_].data.message.sender.user_id}get senderName(){return this[_].data.message.sender.login}get senderDisplayName(){return this[_].data.message.sender.display_name}get senderColor(){return this[_].data.message.sender.chat_color}get sendDate(){return new Date(this[_].data.message.sent_at)}get contentClassification(){return this[_].data.content_classification}get status(){return this[_].data.status}get resolverId(){return this[_].data.resolver_id||null}get resolverName(){return this[_].data.resolver_login||null}};le=n([s("pubsub","PubSubAutoModQueueMessage","messageId")],le);let he=class extends y{get userId(){return this[_].data.user_id}get userName(){return this[_].data.user_name}get message(){return this[_].data.chat_message}get badgeTier(){return this[_].data.badge_tier}};he=n([s("pubsub","PubSubBitsBadgeUnlockMessage","userId")],he);let de=class extends y{get userId(){return this[_].data.user_id}get userName(){return this[_].data.user_name}get message(){return this[_].data.chat_message}get bits(){return this[_].data.bits_used}get totalBits(){return this[_].data.total_bits_used}get isAnonymous(){return this[_].data.is_anonymous}};de=n([s("pubsub","PubSubBitsMessage","userId")],de);let pe=class extends y{constructor(e,t){super(e),this._channelId=t}get channelId(){return this._channelId}get type(){return this[_].data.type}get action(){return this[_].data.moderation_action}get args(){return this[_].data.args}get userId(){return this[_].data.created_by_user_id}get userName(){return this[_].data.created_by}};pe=n([s("pubsub","PubSubChatModActionMessage","userId")],pe);let ge=class extends y{get data(){return this[_]}};ge=n([s("pubsub","PubSubCustomMessage")],ge);let fe=class extends y{get id(){return this[_].data.redemption.id}get userId(){return this[_].data.redemption.user.id}get userName(){return this[_].data.redemption.user.login}get userDisplayName(){return this[_].data.redemption.user.display_name}get channelId(){return this[_].data.redemption.channel_id}get redemptionDate(){return new Date(this[_].data.redemption.redeemed_at)}get rewardId(){return this[_].data.redemption.reward.id}get rewardTitle(){return this[_].data.redemption.reward.title}get rewardPrompt(){return this[_].data.redemption.reward.prompt}get rewardCost(){return this[_].data.redemption.reward.cost}get rewardIsQueued(){return!this[_].data.redemption.reward.should_redemptions_skip_request_queue}get rewardImage(){return this[_].data.redemption.reward.image}get defaultImage(){return this[_].data.redemption.reward.default_image}get message(){return this[_].data.redemption.user_input}get status(){return this[_].data.redemption.status}};fe=n([s("pubsub","PubSubRedemptionMessage","id")],fe);let _e=class extends y{get userId(){const e=this[_];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.recipient_id:e.user_id}get userName(){const e=this[_];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.recipient_user_name:e.user_name}get userDisplayName(){const e=this[_];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.recipient_display_name:e.display_name}get streakMonths(){const e=this[_];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?0:e.streak_months}get cumulativeMonths(){const e=this[_];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.months:e.cumulative_months}get months(){return this.cumulativeMonths}get time(){return new Date(this[_].time)}get message(){return"subgift"===this[_].context||"anonsubgift"===this[_].context?null:this[_].sub_message}get subPlan(){return this[_].sub_plan}get isResub(){return"resub"===this[_].context}get isGift(){return"subgift"===this[_].context||"resubgift"===this[_].context||"anonsubgift"===this[_].context||"anonresubgift"===this[_].context}get isAnonymous(){return"anonsubgift"===this[_].context||"anonresubgift"===this[_].context}get gifterId(){return this.isGift?this[_].user_id:null}get gifterName(){return this.isGift?this[_].user_name:null}get gifterDisplayName(){return this.isGift?this[_].display_name:null}get giftDuration(){const e=this[_];return"subgift"===e.context||"resubgift"===e.context||"anonsubgift"===e.context||"anonresubgift"===e.context?e.multi_month_duration:null}};_e=n([s("pubsub","PubSubSubscriptionMessage","userId")],_e);let ye=class extends y{constructor(e,t){super(e),this._channelId=t}get channelId(){return this._channelId}get messageId(){return this[_].data.message_id}get status(){return this[_].data.status}};ye=n([s("pubsub","PubSubUserModerationNotificationMessage","messageId")],ye);let me=class extends y{get text(){return this[_].data_object.body}get senderId(){return this[_].data_object.from_id.toString()}get senderName(){return this[_].data_object.tags.login}get senderDisplayName(){return this[_].data_object.tags.display_name}};me=n([s("pubsub","PubSubWhisperMessage","senderId")],me);let be=class{constructor(e,t,n,r){this._topic=e,this._userId=t,this._callback=n,this._client=r}get topic(){return this._topic}get userId(){return this._userId}async remove(){await this._client.removeListener(this)}call(e){this._callback(e)}};var ve;n([r(!1)],be.prototype,"_client",void 0),be=n([s("pubsub","PubSubListener","userId")],be);let we=ve=class{constructor(e){this._listeners=new Map;const{authProvider:t,pubSubClient:n,logger:r}=e;this._authProvider=t,this._pubSubClient=null!=n?n:new ue({logger:r}),this._pubSubClient.onMessage((async(e,t)=>{const[n,r,...i]=e.split(".");if(this._listeners.has(e)&&r===await this._getUserId()){const r=ve._parseMessage(n,i,t);for(const t of this._listeners.get(e))t.call(r)}}))}async onAutoModQueue(e,t){return await this._addListener("automod-queue",t,"channel:moderate",I(e))}async onBits(e){return await this._addListener("channel-bits-events-v2",e,"bits:read")}async onBitsBadgeUnlock(e){return await this._addListener("channel-bits-badge-unlocks",e,"bits:read")}async onModAction(e,t){return await this._addListener("chat_moderator_actions",t,"channel:moderate",I(e))}async onRedemption(e){return await this._addListener("channel-points-channel-v1",e,"channel:read:redemptions")}async onUserModeration(e,t){return await this._addListener("user-moderation-notifications",t,"chat:read",I(e))}async onSubscription(e){return await this._addListener("channel-subscribe-events-v1",e,"channel:read:subscriptions")}async onWhisper(e){return await this._addListener("whispers",e,"whispers:read")}async onCustomTopic(e,t,n,r){return r?await this._addListener(e,t,n,I(r)):await this._addListener(e,t,n)}async removeListener(e){if(this._listeners.has(e.topic)){const t=this._listeners.get(e.topic).filter((t=>t!==e));0===t.length?(this._listeners.delete(e.topic),await this._pubSubClient.unlisten(`${e.topic}.${e.userId}`),this._pubSubClient.hasAnyTopics||!this._pubSubClient.isConnected&&!this._pubSubClient.isConnecting||await this._pubSubClient.disconnect()):this._listeners.set(e.topic,t)}}async removeAllListeners(){for(const e of this._listeners.values())for(const t of e)await this.removeListener(t)}static _parseMessage(e,t,n){switch(e){case"automod-queue":return new le(n,t[0]);case"channel-bits-events-v2":return new de(n);case"channel-bits-badge-unlocks":return new he(n);case"channel-points-channel-v1":return new fe(n);case"channel-subscribe-events-v1":return new _e(n);case"chat_moderator_actions":return new pe(n,t[0]);case"user-moderation-notifications":return new ye(n,t[0]);case"whispers":return new me(n);default:return new ge(n)}}async _getUserId(){if(this._userId)return this._userId;const{tokenInfo:e}=await v(this._authProvider);if(!e.userId)throw new k("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");return this._userId=e.userId}async _addListener(e,t,n,...r){await this._pubSubClient.connect();const i=await this._getUserId(),s=[e,i,...r].join("."),o=new be(s,i,t,this);return this._listeners.has(s)?this._listeners.get(s).push(o):(this._listeners.set(s,[o]),await this._pubSubClient.listen(s,this._authProvider,n)),o}};var Ce;n([r(!1)],we.prototype,"_authProvider",void 0),n([r(!1)],we.prototype,"_pubSubClient",void 0),we=ve=n([s("pubsub","SingleUserPubSubClient")],we);let ke=Ce=class{constructor(e){this._userClients=new Map,this._rootClient=null!=e?e:new ue}async registerUserListener(e,t){const n=await Ce._getCorrectUserId(e,t);return this._userClients.set(n,new we({authProvider:e,pubSubClient:this._rootClient})),n}getUserListener(e){const t=I(e);if(!this._userClients.has(t))throw new Error(`No auth provider registered for user ID ${t}\nRegister one using:\n\n\tpubSubClient.registerUserListener(authProvider);`);return this._userClients.get(t)}async onAutoModQueue(e,t,n){return await this.getUserListener(e).onAutoModQueue(t,n)}async onBits(e,t){return await this.getUserListener(e).onBits(t)}async onBitsBadgeUnlock(e,t){return await this.getUserListener(e).onBitsBadgeUnlock(t)}async onModAction(e,t,n){return await this.getUserListener(e).onModAction(t,n)}async onRedemption(e,t){return await this.getUserListener(e).onRedemption(t)}async onSubscription(e,t){return await this.getUserListener(e).onSubscription(t)}async onUserModeration(e,t,n){return await this.getUserListener(e).onUserModeration(t,n)}async onWhisper(e,t){return await this.getUserListener(e).onWhisper(t)}async onCustomTopic(e,t,n,r,i){return await this.getUserListener(e).onCustomTopic(t,n,r,i)}static async _getCorrectUserId(e,t){if(t)return I(t);{if("app"===e.tokenType)throw new k("App tokens are not supported by PubSubClient; you need to pass authentication representing a user.");const{tokenInfo:t}=await v(e);if(!t.userId)throw new k("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");return t.userId}}};n([r(!1)],ke.prototype,"_rootClient",void 0),n([r(!1)],ke.prototype,"_userClients",void 0),ke=Ce=n([s("pubsub","PubSubClient")],ke),i(104);const Ie=new ke;function Oe(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}document.getElementById("muteImage");const Le={token:Oe("token"),rewardName:Oe("rewardname"),mp3:Oe("mp3")};!async function(){const e=new C("f3l7ldc6zwtdunaoe53rzms4icn0pl",Le.token),t=await Ie.registerUserListener(e);document.getElementById("counter"),await Ie.onRedemption(t,(async e=>{if(e.rewardTitle==Le.rewardName){var t=new Audio("https://cdn.discordapp.com/attachments/607542164813250572/1069688175745830932/vine_boom_but_perfectly_bass_boosted.mp3");console.log("redeemed"),t.play()}}))}()})()})();